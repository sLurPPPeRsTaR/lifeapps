{"version":3,"sources":["DdRumResourceTracking.tsx"],"names":["DdRumResourceTracking","startTracking","tracingSamplingRate","firstPartyHosts","isTracking","InternalLog","log","SdkVerbosity","WARN","requestProxy","XHRProxy","xhrType","XMLHttpRequest","resourceReporter","ResourceReporter","filterDevResource","onTrackingStart","firstPartyHostsRegexMap","INFO","stopTracking","onTrackingStop"],"mappings":";;;;;;;AAMA;;AACA;;AAGA;;AAEA;;AACA;;AACA;;;;AAEA;AACA;AACA;AACO,MAAMA,qBAAN,CAA4B;AAI/B;AACJ;AACA;AACwB,SAAbC,aAAa,CAAC;AACjBC,IAAAA,mBADiB;AAEjBC,IAAAA;AAFiB,GAAD,EAMX;AACL;AACA,QAAIH,qBAAqB,CAACI,UAA1B,EAAsC;AAClCC,+BAAYC,GAAZ,CACI,+CADJ,EAEIC,2BAAaC,IAFjB;;AAIA;AACH;;AAED,SAAKC,YAAL,GAAoB,IAAIC,kBAAJ,CAAa;AAC7BC,MAAAA,OAAO,EAAEC,cADoB;AAE7BC,MAAAA,gBAAgB,EAAE,IAAIC,kCAAJ,CAAqB,CAACC,+CAAD,CAArB;AAFW,KAAb,CAApB;AAIA,SAAKN,YAAL,CAAkBO,eAAlB,CAAkC;AAC9Bd,MAAAA,mBAD8B;AAE9Be,MAAAA,uBAAuB,EAAE,qDACrBd,eADqB;AAFK,KAAlC;;AAOAE,6BAAYC,GAAZ,CACI,uCADJ,EAEIC,2BAAaW,IAFjB;;AAIAlB,IAAAA,qBAAqB,CAACI,UAAtB,GAAmC,IAAnC;AACH;;AAEkB,SAAZe,YAAY,GAAS;AACxB,QAAInB,qBAAqB,CAACI,UAA1B,EAAsC;AAClCJ,MAAAA,qBAAqB,CAACI,UAAtB,GAAmC,KAAnC;;AACA,UAAI,KAAKK,YAAT,EAAuB;AACnB,aAAKA,YAAL,CAAkBW,cAAlB;AACH;;AACD,WAAKX,YAAL,GAAoB,IAApB;AACH;AACJ;;AAjD8B;;;;gBAAtBT,qB,gBACmB,K;;gBADnBA,qB","sourcesContent":["/*\n * Unless explicitly stated otherwise all files in this repository are licensed under the Apache License Version 2.0.\n * This product includes software developed at Datadog (https://www.datadoghq.com/).\n * Copyright 2016-Present Datadog, Inc.\n */\n\nimport { InternalLog } from '../../../InternalLog';\nimport { SdkVerbosity } from '../../../SdkVerbosity';\nimport type { FirstPartyHost } from '../../types';\n\nimport { firstPartyHostsRegexMapBuilder } from './domain/firstPartyHosts';\nimport type { RequestProxy } from './domain/interfaces/RequestProxy';\nimport { ResourceReporter } from './implementation/DatadogRumResource/ResourceReporter';\nimport { filterDevResource } from './implementation/DatadogRumResource/internalDevResourceBlocklist';\nimport { XHRProxy } from './implementation/XHRProxy';\n\n/**\n * Provides RUM auto-instrumentation feature to track resources (fetch, XHR, axios) as RUM events.\n */\nexport class DdRumResourceTracking {\n    private static isTracking = false;\n    private static requestProxy: RequestProxy | null;\n\n    /**\n     * Starts tracking resources and sends a RUM Resource event every time a network request is detected.\n     */\n    static startTracking({\n        tracingSamplingRate,\n        firstPartyHosts\n    }: {\n        tracingSamplingRate: number;\n        firstPartyHosts: FirstPartyHost[];\n    }): void {\n        // extra safety to avoid proxying the XHR class twice\n        if (DdRumResourceTracking.isTracking) {\n            InternalLog.log(\n                'Datadog SDK is already tracking XHR resources',\n                SdkVerbosity.WARN\n            );\n            return;\n        }\n\n        this.requestProxy = new XHRProxy({\n            xhrType: XMLHttpRequest,\n            resourceReporter: new ResourceReporter([filterDevResource])\n        });\n        this.requestProxy.onTrackingStart({\n            tracingSamplingRate,\n            firstPartyHostsRegexMap: firstPartyHostsRegexMapBuilder(\n                firstPartyHosts\n            )\n        });\n\n        InternalLog.log(\n            'Datadog SDK is tracking XHR resources',\n            SdkVerbosity.INFO\n        );\n        DdRumResourceTracking.isTracking = true;\n    }\n\n    static stopTracking(): void {\n        if (DdRumResourceTracking.isTracking) {\n            DdRumResourceTracking.isTracking = false;\n            if (this.requestProxy) {\n                this.requestProxy.onTrackingStop();\n            }\n            this.requestProxy = null;\n        }\n    }\n}\n"]}