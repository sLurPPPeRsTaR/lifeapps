{"version":3,"sources":["DatadogProvider.tsx"],"names":["isInitialized","isConfigurationPartial","configuration","DatadogProviderConfiguration","DdSdkReactNativeConfiguration","console","warn","initializeDatadog","onInitialization","DdSdkReactNative","_initializeFromDatadogProvider","error","InternalLog","log","SdkVerbosity","WARN","DatadogProvider","children","_enableFeaturesFromDatadogProvider","initialize","_initializeFromDatadogProviderWithConfigurationAsync","__internalResetIsInitializedForTesting"],"mappings":";;;;;;;AAKA;;AAGA;;AAQA;;AACA;;AACA;;;;AAlBA;AACA;AACA;AACA;AACA;AAgBA,IAAIA,aAAa,GAAG,KAApB;;AAwBA,MAAMC,sBAAsB,GACxBC,aAD2B,IAIyB;AACpD,MAAIA,aAAa,YAAYC,2DAA7B,EAA2D;AACvD,WAAO,KAAP;AACH;;AACD,MAAID,aAAa,YAAYE,4DAA7B,EAA4D;AACxD;AACAC,IAAAA,OAAO,CAACC,IAAR,CACI,iHADJ;AAGA,WAAO,KAAP;AACH;;AACD,SAAO,IAAP;AACH,CAhBD;;AAkBA,MAAMC,iBAAiB,GAAG,OACtBL,aADsB,EAEtBM,gBAFsB,KAGrB;AACD,QAAMC,mCAAiBC,8BAAjB,CAAgDR,aAAhD,CAAN;;AACA,MAAIM,gBAAJ,EAAsB;AAClB,QAAI;AACAA,MAAAA,gBAAgB;AACnB,KAFD,CAEE,OAAOG,KAAP,EAAc;AACZC,+BAAYC,GAAZ,CACK,2CAA0CF,KAAM,EADrD,EAEIG,2BAAaC,IAFjB;AAIH;AACJ;AACJ,CAfD;AAiBA;AACA;AACA;;;AACO,MAAMC,eAAmD,GAAG,CAAC;AAChEC,EAAAA,QADgE;AAEhEf,EAAAA,aAFgE;AAGhEM,EAAAA;AAHgE,CAAD,KAI7D;AACF,MAAI,CAACR,aAAL,EAAoB;AAChB;AACA;AACA;AACA;AACA,QAAIC,sBAAsB,CAACC,aAAD,CAA1B,EAA2C;AACvCO,yCAAiBS,kCAAjB,CAAoDhB,aAApD;;AACAc,MAAAA,eAAe,CAACR,gBAAhB,GAAmCA,gBAAnC;AACH,KAHD,MAGO;AACHD,MAAAA,iBAAiB,CAACL,aAAD,EAAgBM,gBAAhB,CAAjB;AACH;;AACDR,IAAAA,aAAa,GAAG,IAAhB;AACH;;AAED,sBAAO,4DAAGiB,QAAH,CAAP;AACH,CApBM;AAsBP;AACA;AACA;AACA;;;;;AACAD,eAAe,CAACG,UAAhB,GAA6B,MACzBjB,aADyB,IAExB;AACD,QAAMO,mCAAiBW,oDAAjB,CACFlB,aADE,CAAN;;AAGA,MAAIc,eAAe,CAACR,gBAApB,EAAsC;AAClCQ,IAAAA,eAAe,CAACR,gBAAhB;AACH;AACJ,CATD;;AAWO,MAAMa,sCAAsC,GAAG,MAAM;AACxDrB,EAAAA,aAAa,GAAG,KAAhB;AACH,CAFM","sourcesContent":["/*\n * Unless explicitly stated otherwise all files in this repository are licensed under the Apache License Version 2.0.\n * This product includes software developed at Datadog (https://www.datadoghq.com/).\n * Copyright 2016-Present Datadog, Inc.\n */\nimport React from 'react';\nimport type { PropsWithChildren } from 'react';\n\nimport {\n    DatadogProviderConfiguration,\n    DdSdkReactNativeConfiguration\n} from '../../DdSdkReactNativeConfiguration';\nimport type {\n    PartialInitializationConfiguration,\n    AutoInstrumentationConfiguration\n} from '../../DdSdkReactNativeConfiguration';\nimport { DdSdkReactNative } from '../../DdSdkReactNative';\nimport { InternalLog } from '../../InternalLog';\nimport { SdkVerbosity } from '../../SdkVerbosity';\n\nlet isInitialized = false;\n\ntype Props = PropsWithChildren<{\n    /**\n     * If a `DatadogProviderConfiguration` instance is passed, the SDK will start tracking errors, resources and actions and sending events.\n     *\n     * If a `AutoInstrumentationConfiguration` object is passed, the SDK will start tracking errors, resources and actions. To start sending events, call `DatadogProvider.initialize`.\n     */\n    configuration:\n        | DatadogProviderConfiguration\n        | AutoInstrumentationConfiguration;\n    /**\n     * Callback to be run once the SDK starts sending events.\n     */\n    onInitialization?: () => void;\n}>;\n\ntype StaticProperties = {\n    initialize: (\n        configuration: PartialInitializationConfiguration\n    ) => Promise<void>;\n    onInitialization?: () => void;\n};\n\nconst isConfigurationPartial = (\n    configuration:\n        | DatadogProviderConfiguration\n        | AutoInstrumentationConfiguration\n): configuration is AutoInstrumentationConfiguration => {\n    if (configuration instanceof DatadogProviderConfiguration) {\n        return false;\n    }\n    if (configuration instanceof DdSdkReactNativeConfiguration) {\n        // Not using InternalLog here as it is not yet instanciated\n        console.warn(\n            'A DdSdkReactNativeConfiguration was passed to DatadogProvider. Please use DatadogProviderConfiguration instead.'\n        );\n        return false;\n    }\n    return true;\n};\n\nconst initializeDatadog = async (\n    configuration: DatadogProviderConfiguration,\n    onInitialization?: () => void\n) => {\n    await DdSdkReactNative._initializeFromDatadogProvider(configuration);\n    if (onInitialization) {\n        try {\n            onInitialization();\n        } catch (error) {\n            InternalLog.log(\n                `Error running onInitialization callback ${error}`,\n                SdkVerbosity.WARN\n            );\n        }\n    }\n};\n\n/**\n * Set up the Datadog React Native SDK.\n */\nexport const DatadogProvider: React.FC<Props> & StaticProperties = ({\n    children,\n    configuration,\n    onInitialization\n}) => {\n    if (!isInitialized) {\n        // Here we cannot use a useEffect hook since it would be called after\n        // the first render. Thus, we wouldn't enable auto-instrumentation on\n        // the elements rendered in this first render and what happens during\n        // the first render.\n        if (isConfigurationPartial(configuration)) {\n            DdSdkReactNative._enableFeaturesFromDatadogProvider(configuration);\n            DatadogProvider.onInitialization = onInitialization;\n        } else {\n            initializeDatadog(configuration, onInitialization);\n        }\n        isInitialized = true;\n    }\n\n    return <>{children}</>;\n};\n\n/**\n * Initialize the Datadog SDK to start sending RUM events, logs and traces,\n * then execute onInitialization callback if any was provided.\n */\nDatadogProvider.initialize = async (\n    configuration: PartialInitializationConfiguration\n) => {\n    await DdSdkReactNative._initializeFromDatadogProviderWithConfigurationAsync(\n        configuration\n    );\n    if (DatadogProvider.onInitialization) {\n        DatadogProvider.onInitialization();\n    }\n};\n\nexport const __internalResetIsInitializedForTesting = () => {\n    isInitialized = false;\n};\n"]}